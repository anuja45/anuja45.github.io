<!DOCTYPE html>
<html>
  <head>
    <title>Download Attachment</title>
    <script src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      h1 {
        font-size: 18px;
        margin-bottom: 10px;
      }
      #attachmentList {
        margin-top: 15px;
        padding-left: 15px;
      }
      li {
        margin-bottom: 5px;
      }
    </style>
  </head>
  <body>
    <h1>Email Attachments</h1>
    <button id="downloadAttachment">Download Attachments</button>
    <p id="msg"></p>
  </body>
  <script>
    // Wait for Office to be ready
    Office.onReady(() => {
      if (Office.context.mailbox) {
        console.log("Add-in is ready!");
      }
    });

    function downloadAttachment(attachment) {
      office.context.mailbox.getAttachmentContentAsync(
        attachment.id,
        function (result) {
          if (result.status === Office.AsyncResultStatus.Succeded) {
            const attachmentContent = result.value.content;
            const blob = new Blob([attachmentContent], {
              type: "application/octet-stream",
            });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = attachment.name;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          } else {
            // No attachments found
            document.getElementById("msg").textContent =
              "Failed to download";
          }
        }
      );
    }

    function downloadAll() {
      const item = Office.context.mailbox.item;
      if (item.attachments && item.attachments.length > 0) {
        item.attachments.forEach((attachment) => {
          download(attachment);
        });
      } else {
        alert("No attachment found");
      }
    }

    // Bind the button to the function
    document.getElementById("downloadAttachment").onclick = downloadAll;
  </script>
</html>
